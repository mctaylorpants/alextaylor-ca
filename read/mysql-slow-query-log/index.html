<!DOCTYPE HTML>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="generator" content="Nanoc 4.13.3">

    <title>alextaylor.ca - Playing with MySQL's slow query log</title>

    <link rel="stylesheet" href="https://unpkg.com/purecss@2.0.6/build/pure-min.css" integrity="sha384-Uu6IeWbM+gzNVXJcM9XV3SohHtmWE+3VGi496jvgX1jyvDTXfdK+rfZc8C1Aehk5" crossorigin="anonymous">
    <link rel="stylesheet" href="/stylesheet.css">
    <link rel="stylesheet" href="/code-highlighting.css">

    <!-- favicon generated by https://favicon.io/favicon-generator/ -->
    <!-- Font Copyright (c) 2010-2012, Vernon Adams (vern@newtypography.co.uk), with Reserved Font Names "Coda" -->
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
    <link rel="manifest" href="/site.webmanifest">

    <link rel="alternate" type="application/atom+xml" title="Atom feed" href="https://alextaylor.ca/atom.xml" />

    <meta property="og:site_name" content="alextaylor.ca" />
    <meta property="og:type" content="article" />

    
      <meta property="og:image" content="https://alextaylor.ca/images/taylormade_og_image.png" />
      <meta property="og:title" content="Playing with MySQL's slow query log" />
      <meta property="og:description" content="Like any developer, I love a good feedback loop. Not only is a quick feedback loop essential for flow, it‚Äôs also usually the best way to wrap your head around how something works.

But feedback loo..." />
      <meta property="og:url" content="https://alextaylor.ca/read/mysql-slow-query-log/" />
      <meta name="twitter:card" content="summary_large_image"></meta>
    
  </head>
  <body>
    <div class="pure-g">
      <div class="pure-u-1 header">
        <div class="l-box">
          <h1>
            <a href="/">
              <span class="light">~/</span>taylormade
            </a>
          </h1>
          <hr />
        </div>
      </div>

      <div class="pure-u-1 content">
        <div class="l-box">
          
            <h1>Playing with MySQL's slow query log</h1>
            <p class="post-meta">
              March 7, 2024
            </p>
          

          <p>Like any developer, I love a good feedback loop. Not only is a quick feedback loop essential for flow, it‚Äôs also usually the best way to wrap your head around how something works.</p>

<p>But feedback loops can be harder to come by when you‚Äôre dealing with optimizing poorly-performing database queries. A bad query in production is like a bug that needs to be reproduced - or at least understood - before you can fix it; but since the poor performance is almost always related to the data it‚Äôs operating on, you can‚Äôt usually run it locally and get the same results. (And I hope you can‚Äôt ‚Äújust‚Äù run it in a console on production, either! üò±)</p>

<p>So instead of feedback loops, we need to rely on telemetry, like <code>EXPLAIN</code>s run on production or MySQL‚Äôs slow query log, which provides insightful statistics on what‚Äôs happening under the hood.</p>

<p>In order to get more familiar with the slow query log‚Äôs format and what it can tell me about queries, I decided to turn it on locally.</p>

<h2 id="hello-slow-query-log">
<a href="#hello-slow-query-log"></a>Hello, slow query log</h2>

<p>First, I logged on to my app‚Äôs MySQL instance as root so I could flip a couple switches.</p>

<pre><code>$&gt; mysql -u root -p -h 127.0.0.1 -P 3306
</code></pre>

<p>The slow query log‚Äôs controlled by the <code>slow_query_log</code> variable. You can also customize what counts as a ‚Äúslow query‚Äù. For learning purposes, I wanted the most pessimistic definition of a slow query, which is to say any query that takes any time to execute at all!</p>

<pre><code>mysql&gt; set global slow_query_log = 'on';
mysql&gt; set global long_query_time = 0;
</code></pre>

<p>Next, I needed to figure out where this thing actually logs to. That‚Äôs another variable (which can be customized if needed):</p>

<pre><code>mysql&gt; show variables like 'slow_query_log_file';

+---------------------+-------------------------------+
| Variable_name       | Value                         |
+---------------------+-------------------------------+
| slow_query_log_file | /var/lib/mysql/mysql-slow.log |
+---------------------+-------------------------------+
1 row in set (0.00 sec)
</code></pre>

<h2 id="setting-up-a-feedback-loop">
<a href="#setting-up-a-feedback-loop"></a>Setting up a feedback loop</h2>

<p>With that enabled, I opened another terminal and started tailing the log, so I could write queries in one window and see the results in the other. Boom, feedback loop!</p>

<pre><code>$&gt; tail -f /var/lib/mysql/mysql-slow.log
</code></pre>

<h2 id="grokking-the-output">
<a href="#grokking-the-output"></a>Grokking the output</h2>

<p>Let‚Äôs fire off a query to see what it looks like. I started with something basic, <code>select id from notes</code>.</p>

<p>Here‚Äôs what my output looks like. The query‚Äôs at the bottom, with all the metrics about that query displayed as comments above:</p>

<pre><code># Time: 240229 13:17:28
# User@Host: root[root] @  [192.168.65.1]  Id:    66
# Schema: development_1  Last_errno: 0  Killed: 0
# ...  Rows_sent: 10025  Rows_examined: 10025  Rows_affected: 0
# Bytes_sent: 110358  Tmp_tables: 0  Tmp_disk_tables: 0  Tmp_table_sizes: 0
# InnoDB_trx_id: FE20C
# QC_Hit: No  Full_scan: Yes  Full_join: No  Tmp_table: No  Tmp_table_on_disk: No
# Filesort: No  Filesort_on_disk: No  Merge_passes: 0
#   InnoDB_IO_r_ops: 0  InnoDB_IO_r_bytes: 0  InnoDB_IO_r_wait: 0.000000
#   InnoDB_rec_lock_wait: 0.000000  InnoDB_queue_wait: 0.000000
#   InnoDB_pages_distinct: 14
select id from notes;
</code></pre>

<p>There‚Äôs a lot of output here, but what I focused on first was <code>Rows_sent</code> and <code>Rows_examined</code>. When these values differ wildly, it can be a sign that the query is not as performant as it could be.</p>

<h2 id="examining-rowsexamined">
<a href="#examining-rowsexamined"></a>Examining <code>Rows_examined</code>
</h2>

<p>Right now, my <code>notes</code> table has 20,036 records in it:</p>

<pre><code>mysql&gt; select count(*) from notes;
+----------+
| count(*) |
+----------+
|    20036 |
+----------+
1 row in set (0.01 sec)
</code></pre>

<p>When I issue a simple query to fetch all the IDs, <code>Rows_sent</code> and <code>Rows_examined</code> are identical, since MySQL can use the <code>PRIMARY</code> index without any additional overhead:</p>

<pre><code># Rows_sent: 20036  Rows_examined: 20036  Rows_affected: 0
select id from notes;
</code></pre>

<p>What happens if I add an <code>order by</code> on a column which is <em>not</em> indexed?</p>

<pre><code># Rows_sent: 20036  Rows_examined: 40072  Rows_affected: 0
select id from notes order by date;
</code></pre>

<p><code>Rows_examined</code> doubles!</p>

<p>Compare this to ordering by <code>account_id</code>, which <em>is</em> indexed:</p>

<pre><code># Rows_sent: 20036  Rows_examined: 20036  Rows_affected: 0
select id from notes order by account_id;
</code></pre>

<p>I‚Äôm guessing that since MySQL is able to pull that query in the same order as the index, there‚Äôs no additional overhead to the sort. On the other hand, sorting by an un-indexed column looks like it‚Äôs two steps: pulling the data, then looking at <code>date</code> on each row.</p>

<h2 id="conclusion">
<a href="#conclusion"></a>Conclusion</h2>

<p>I learned a few useful things from playing around with the slow query log:</p>

<ul>
  <li>Being able to see instant telemetry about the query I just ran makes for a great feedback loop. It doesn‚Äôt address the challenge of reproducing a poorly-performing query locally, but being able to experiment and understand the output comes in handy when looking at real slow-query logs from production.</li>
  <li>The slow-query log makes a great complement to an <code>EXPLAIN</code> plan: an <code>EXPLAIN</code> tells you what‚Äôs <em>going</em> to happen, whereas the slow query log tells you what <em>actually</em> happened.</li>
</ul>

<p>That‚Äôs it for now!</p>


        </div>
      </div>

      <div class="pure-u-1">
        
          <div class="l-box">
            <hr />

            <p>
              <em>Keep reading:</em>
            </p>

            
              <a href=https://alextaylor.ca/read/down-a-qmk-rabbit-hole/>
                <div class="article-box">
                  ‚ùÆ Down a QMK rabbit hole
                </div>
              </a>
            

            
              <a href=https://alextaylor.ca/read/grokking-instance-eval/>
                <div class="article-box" style="text-align: right">
                  Grokking instance_eval ‚ùØ
                </div>
              </a>
            

            <a href="/archive">
              <div class="article-box" style="text-align: center">
                Archive
              </div>
            </a>
          </div>
        

        <div class="l-box">
          <hr />
          <p class="footer">
            &copy; 2025 <strong>Alex Taylor</strong>
          </p>
          <p class="footer">
            <a href="https://alextaylor.ca/atom.xml">atom feed</a>
          </p>
          <p class="footer">
            <a href="https://github.com/mctaylorpants">github</a>
            &middot;
            <a href="https://www.linkedin.com/in/alexmorgantaylor/">linkedin</a>
            &middot;
            <a href="https://x.com/mctaylorpants">x</a>
            &middot;
            <a rel="me" href="https://ruby.social/@alextaylor">mastodon</a>
          </p>
        </div>
      </div>
    </div>
  </body>
</html>
