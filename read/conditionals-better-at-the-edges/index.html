<!DOCTYPE HTML>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="generator" content="Nanoc 4.12.2">

    <title>alextaylor.ca - Conditionals: Better at the Edges</title>

    <link rel="stylesheet" href="https://unpkg.com/purecss@2.0.6/build/pure-min.css" integrity="sha384-Uu6IeWbM+gzNVXJcM9XV3SohHtmWE+3VGi496jvgX1jyvDTXfdK+rfZc8C1Aehk5" crossorigin="anonymous">
    <link rel="stylesheet" href="/stylesheet.css">
    <link rel="stylesheet" href="/code-highlighting.css">

    <!-- favicon generated by https://favicon.io/favicon-generator/ -->
    <!-- Font Copyright (c) 2010-2012, Vernon Adams (vern@newtypography.co.uk), with Reserved Font Names "Coda" -->
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
    <link rel="manifest" href="/site.webmanifest">

    <link rel="alternate" type="application/atom+xml" title="Atom feed" href="https://alextaylor.ca/atom.xml" />

    <meta property="og:site_name" content="alextaylor.ca" />
    <meta property="og:type" content="article" />

    
      <meta property="og:image" content="https://alextaylor.ca/images/taylormade_og_image.png" />
      <meta property="og:title" content="Conditionals: Better at the Edges" />
      <meta property="og:description" content="I think a lot about conditionals. They proliferate with astonishing speed, and each new branch adds a cognitive burden to the next person who needs to understand what the code is doing — not to men..." />
      <meta property="og:url" content="https://alextaylor.ca/read/conditionals-better-at-the-edges/" />
      <meta name="twitter:card" content="summary_large_image"></meta>
    
  </head>
  <body>
    <div class="pure-g">
      <div class="pure-u-1 header">
        <div class="l-box">
          <h1>
            <a href="/">
              <span class="light">~/</span>taylormade
            </a>
          </h1>
          <hr />
        </div>
      </div>

      <div class="pure-u-1 content">
        <div class="l-box">
          
            <h1>Conditionals: Better at the Edges</h1>
            <p class="post-meta">
              February 24, 2022
            </p>
          

          <p>I think a lot about conditionals. They proliferate with astonishing speed, and each new branch adds a cognitive burden to the next person who needs to understand what the code is doing — not to mention, bugs love hiding in conditionals!</p>

<p>There are a lot of strategies out there on how to deal with conditionals, from <a href="https://xp123.com/articles/refactoring-pull-common-code-conditional/">refactoring recipes</a> to <a href="https://www.youtube.com/watch?v=8bZh5LMaSmE">object-oriented approaches</a>. Something that they all have in common is the idea that <strong>conditionals are better at the edges than in the middle.</strong></p>

<p>Put another way, if your code path needs to branch, it’s often better to do it as early as possible, or as late as possible. Doing this helps cut down on the amount of paths through a given piece of code, and makes it easier to reason about.</p>

<h2 id="learning-by-example">
<a href="#learning-by-example"></a>Learning by example</h2>

<p>I was doing some code-diving recently and came across this function in our frontend code. It pulls data for a table which displays rows of three similar but distinct records:</p>

<ul>
  <li>Users</li>
  <li>Invitations (for users who haven’t yet activated their account)</li>
  <li>Licenses (or “seats”, which may be filled by inviting a new user)</li>
</ul>

<p>The code makes three API calls to fetch each type of data, then builds up one list for the table. It looks like this:</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="nx">userLists</span><span class="p">:</span> <span class="nx">UserLike</span><span class="p">[][];</span>

<span class="c1">// (code to populate userLists goes here)</span>

<span class="kd">const</span> <span class="nx">users</span><span class="p">:</span> <span class="nx">UserLike</span><span class="p">[]</span> <span class="o">=</span> <span class="p">[];</span>

<span class="k">for</span> <span class="p">(</span><span class="kd">let</span> <span class="nx">userList</span> <span class="k">of</span> <span class="nx">userLists</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">for</span> <span class="p">(</span><span class="kd">let</span> <span class="nx">user</span> <span class="k">of</span> <span class="nx">userList</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">users</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="o">&lt;</span><span class="nx">User</span><span class="o">&gt;</span><span class="p">{</span>
      <span class="p">...</span><span class="nx">user</span><span class="p">,</span>
      <span class="na">name</span><span class="p">:</span> <span class="nx">user</span><span class="p">.</span><span class="nx">name</span> <span class="o">||</span> <span class="kc">null</span><span class="p">,</span>
      <span class="na">roles</span><span class="p">:</span> <span class="nx">user</span><span class="p">.</span><span class="nx">roles</span> <span class="o">||</span> <span class="p">[],</span>
      <span class="na">status</span><span class="p">:</span> <span class="nx">user</span><span class="p">.</span><span class="nx">status</span>
        <span class="p">?</span> <span class="nx">user</span><span class="p">.</span><span class="nx">status</span>
        <span class="p">:</span> <span class="k">typeof</span> <span class="nx">user</span><span class="p">.</span><span class="nx">enabled</span> <span class="o">!==</span> <span class="dl">"</span><span class="s2">boolean</span><span class="dl">"</span>
        <span class="p">?</span> <span class="nx">UserStatus</span><span class="p">.</span><span class="nx">Invited</span>
        <span class="p">:</span> <span class="nx">user</span><span class="p">.</span><span class="nx">enabled</span>
        <span class="p">?</span> <span class="nx">UserStatus</span><span class="p">.</span><span class="nx">Active</span>
        <span class="p">:</span> <span class="nx">UserStatus</span><span class="p">.</span><span class="nx">Inactive</span><span class="p">,</span>
      <span class="na">user_type</span><span class="p">:</span> <span class="nx">user</span><span class="p">.</span><span class="nx">user_type</span> <span class="o">||</span> <span class="nx">user</span><span class="p">.</span><span class="nx">subscription_type</span><span class="p">,</span>
    <span class="p">});</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p>There aren’t too many lines, but this code is <em>dense</em> and full of conditionals. Let’s break down what’s happening:</p>

<ul>
  <li>If the user has a name, use it - otherwise, set it to <code>null</code>.</li>
  <li>If the user has a list of roles, use those - otherwise set it to an empty array.</li>
  <li>If the user has a status, use it - otherwise, check if the user <em>does not</em> have a boolean <code>enabled</code>  attribute. If they don’t, set their status to “invited”. Otherwise, check if they’re enabled. If they are, set their status to “active.” If they aren’t, set their status to “inactive.” (phew!)</li>
  <li>If the user has a <code>user_type</code> attribute already, use it. Otherwise, set <code>user_type</code> to the value of <code>subscription_type</code>.</li>
</ul>

<p>It took me awhile to wrap my head around this, but eventually I realized what was really going on: each of the three data sources (users, invitations and licenses) is of a slightly different shape, and we want to normalize each type into a unified “User-like” type so we can display it in the same table.</p>

<p>Let’s think about how we can eliminate these conditionals.</p>

<h2 id="pull-up-pull-up">
<a href="#pull-up-pull-up"></a>Pull up! Pull up!</h2>

<p>There are different reasons for each conditional in the code above, but ultimately they’re all asking the same question: <strong>am I dealing with a user, an invitation, or a license?</strong></p>

<p>With that in mind, maybe we could pull that question <em>up</em> and deal with it first:</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="nx">invitationsList</span><span class="p">:</span> <span class="nx">UserLike</span><span class="p">[];</span>
<span class="kd">const</span> <span class="nx">usersList</span><span class="p">:</span> <span class="nx">UserLike</span><span class="p">[];</span>
<span class="kd">const</span> <span class="nx">subscriptionsList</span><span class="p">:</span> <span class="nx">UserLike</span><span class="p">[];</span>

<span class="c1">// (code to populate the lists goes here)</span>

<span class="kd">const</span> <span class="nx">users</span><span class="p">:</span> <span class="nx">UserLike</span><span class="p">[]</span> <span class="o">=</span> <span class="p">[];</span>

<span class="k">for</span> <span class="p">(</span><span class="kd">let</span> <span class="nx">invitation</span> <span class="k">of</span> <span class="nx">invitationsList</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">users</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="o">&lt;</span><span class="nx">User</span><span class="o">&gt;</span><span class="p">{</span>
    <span class="p">...</span><span class="nx">invitation</span><span class="p">,</span>
    <span class="na">name</span><span class="p">:</span> <span class="kc">null</span><span class="p">,</span>
    <span class="na">rate</span><span class="p">:</span> <span class="kc">null</span><span class="p">,</span>
    <span class="na">status</span><span class="p">:</span> <span class="nx">UserStatus</span><span class="p">.</span><span class="nx">Invited</span><span class="p">,</span>
  <span class="p">});</span>
<span class="p">}</span>

<span class="k">for</span> <span class="p">(</span><span class="kd">let</span> <span class="nx">user</span> <span class="k">of</span> <span class="nx">usersList</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">users</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="o">&lt;</span><span class="nx">User</span><span class="o">&gt;</span><span class="p">{</span>
    <span class="p">...</span><span class="nx">user</span><span class="p">,</span>
    <span class="na">status</span><span class="p">:</span> <span class="nx">user</span><span class="p">.</span><span class="nx">enabled</span> <span class="p">?</span> <span class="nx">UserStatus</span><span class="p">.</span><span class="nx">Active</span> <span class="p">:</span> <span class="nx">UserStatus</span><span class="p">.</span><span class="nx">Inactive</span><span class="p">,</span>
    <span class="na">user_type</span><span class="p">:</span> <span class="nx">user</span><span class="p">.</span><span class="nx">subscription_type</span><span class="p">,</span>
  <span class="p">});</span>
<span class="p">}</span>

<span class="k">for</span> <span class="p">(</span><span class="kd">let</span> <span class="nx">subscription</span> <span class="k">of</span> <span class="nx">subscriptionsList</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">users</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="o">&lt;</span><span class="nx">User</span><span class="o">&gt;</span><span class="p">{</span>
    <span class="p">...</span><span class="nx">subscription</span><span class="p">,</span>
    <span class="na">name</span><span class="p">:</span> <span class="kc">null</span><span class="p">,</span>
    <span class="na">rate</span><span class="p">:</span> <span class="kc">null</span><span class="p">,</span>
    <span class="na">roles</span><span class="p">:</span> <span class="p">[],</span>
    <span class="na">user_type</span><span class="p">:</span> <span class="kc">undefined</span><span class="p">,</span>
  <span class="p">});</span>
<span class="p">}</span>
</code></pre></div></div>

<p>Here, the question of “what thing am I dealing with” is answered by each separate <code>for</code> loop: inside each loop, we only need to worry about one type of thing.</p>

<p>Nearly all of the conditionals that existed in the old version are gone. The only exception is a simple ternary which sets a user to “active” or “inactive” based on the <code>enabled</code> boolean, which makes a lot of sense now that it’s not buried in the nested ternary statement from earlier.</p>

<p>You might notice we’ve traded conditionals for duplication. I think that’s a worthwhile tradeoff in this case, because the resulting code is easier to understand. The duplication is trivial, and it actually serves to highlight how each type of object differs from each other.</p>

<h2 id="conclusion">
<a href="#conclusion"></a>Conclusion</h2>
<p>Whenever I see a conditional now, I try to ask myself the question, “can I pull this up or push it down?” Sometimes the answer is “no”, but it’s a useful exercise nonetheless.</p>


        </div>
      </div>

      <div class="pure-u-1">
        
          <div class="l-box">
            <hr />

            <p>
              <em>Keep reading:</em>
            </p>

            
              <a href=https://alextaylor.ca/read/teach-yourself-something-you-already-know/>
                <div class="article-box">
                  ❮ Teach yourself something you already know
                </div>
              </a>
            

            
              <a href=https://alextaylor.ca/read/practicing-boundaries/>
                <div class="article-box" style="text-align: right">
                  Practicing boundaries ❯
                </div>
              </a>
            

            <a href="/archive">
              <div class="article-box" style="text-align: center">
                Archive
              </div>
            </a>
          </div>
        

        <div class="l-box">
          <hr />
          <p class="footer">
            &copy; 2024 <strong>Alex Taylor</strong>
          </p>
          <p class="footer">
            <a href="https://alextaylor.ca/atom.xml">atom feed</a>
          </p>
          <p class="footer">
            <a href="https://github.com/mctaylorpants">github</a>
            &middot;
            <a href="https://www.linkedin.com/in/alexmorgantaylor/">linkedin</a>
            &middot;
            <a href="https://x.com/mctaylorpants">x</a>
            &middot;
            <a rel="me" href="https://ruby.social/@alextaylor">mastodon</a>
          </p>
        </div>
      </div>
    </div>
  </body>
</html>
